# YouTube・Youkuダウンロードツール

このStreamlitアプリケーションは、YouTubeとYoukuから動画と音声をダウンロードするためのツールです。403エラー対策を重視し、Streamlit Cloud環境での動作を最適化した設計になっています。

> **重要な注意事項**  
> - このツールは個人利用のみを目的としています
> - 著作権で保護されたコンテンツのダウンロードには十分注意してください
> - YouTubeとYoukuの利用規約を遵守してください
> - Youkuのコンテンツは地域制限の対象となる場合があります
> - 教育目的でのみ提供されており、著作権侵害を助長するものではありません

## 主な機能

### ダウンロードモード
- **音声のみモード**: 高品質なMP3音声ファイル（192kbps）を抽出
- **映像モード**: 完全な動画をMP4形式で保存（最高画質）

### 403エラー対策機能
- 複数回のリトライ機能
- 強化されたユーザーエージェント設定
- 地域制限バイパス機能
- ブラウザクッキー使用オプション
- キャッシュクリア機能
- 段階的待機時間の実装

### Streamlit Cloud最適化
- Cloud環境での動作に特化した設定
- ffmpegの自動検出
- 環境固有のキャッシュ管理
- 詳細なエラー診断とトラブルシューティング

## 動作環境

### 必要なシステム要件
- Python 3.7以上
- Streamlit Cloud環境（推奨）
- ffmpeg（packages.txtで自動インストール）

### サポートプラットフォーム
- **YouTube**: 完全対応（すべてのURL形式）
- **Youku**: 地域制限および仕様変更に対応

## インストールと設定

### Streamlit Cloudでのデプロイ
1. GitHubリポジトリをフォークまたはクローン
2. Streamlit Cloudアカウントでリポジトリを接続
3. 自動的にデプロイが開始されます

### ローカル環境での実行
```bash
# リポジトリのクローン
git clone [リポジトリURL]
cd youtube-youku-downloader

# 必要なパッケージのインストール
pip install -r requirements.txt

# Streamlitアプリの起動
streamlit run main.py
```

## 使用方法

### 基本的な使い方
1. アプリケーションを起動
2. ダウンロードモード（音声のみ/映像）を選択
3. YouTubeまたはYoukuのURLを入力
4. 必要に応じて403エラー対策オプションを設定
5. 「ダウンロード」ボタンをクリック
6. 処理完了後、ファイルをダウンロード

### サポートするURL形式

#### YouTube
- `https://www.youtube.com/watch?v=XXXXXXXXX`
- `https://youtu.be/XXXXXXXXX`
- その他のYouTube URL形式

#### Youku
- `https://v.youku.com/v_show/id_XXXXXXXXX.html`
- `https://m.youku.com/video/id_XXXXXXXXX.html`
- その他のYouku URL形式（自動で標準形式に変換）

### 403エラー対策オプション

#### ブラウザクッキー使用
- Firefoxのクッキーを利用してダウンロード
- 一部の制限動画に有効

#### キャッシュクリア
- 古いキャッシュが原因の403エラーを防止
- ダウンロード前の自動クリアまたは手動クリア

#### 詳細設定
- デバッグモード: 詳細なログ表示
- 品質設定: 最高品質/標準品質/低品質

## トラブルシューティング

### 403エラーが発生する場合

#### Streamlit Cloud環境での対処法
1. **requirements.txtの確認**
   - `yt-dlp>=2025.01.15` が記載されているか確認
   - 必要に応じてGitHubで更新

2. **アプリの再デプロイ**
   - GitHubでコミット後、自動再デプロイを待機
   - Streamlit Cloudで手動再起動

3. **設定オプションの活用**
   - 「ブラウザクッキーを使用」をON
   - 「ダウンロード前にキャッシュをクリア」をON

4. **代替手段**
   - 時間をおいて再試行
   - 異なる動画で動作確認

### よくある問題と解決策

#### ネットワーク関連
- インターネット接続の確認
- プロキシ設定の確認
- VPN使用時の影響

#### 動画アクセス関連
- 動画の公開状態確認
- 地域制限の確認
- プライベート動画でないか確認

#### Youku固有の問題
- 地域制限（中国本土からのアクセスが必要な場合）
- yt-dlpの最新バージョン確認
- URL形式の自動変換機能

### エラーメッセージの解読

#### HTTP 403 Forbidden
```
**Streamlit Cloud での 403エラー解決策:**
1. requirements.txt で yt-dlp>=2025.01.15 を指定
2. アプリを再デプロイしてyt-dlpを更新
3. 「ブラウザクッキーを使用」オプションを試す
4. 「キャッシュをクリア」してから再試行
5. しばらく時間をおいてから再試行
```

## 技術的詳細

### 使用技術
- **フロントエンド**: Streamlit
- **ダウンロードエンジン**: yt-dlp
- **メディア処理**: ffmpeg
- **実行環境**: Streamlit Cloud

### 403エラー対策の実装
- 最大5回のリトライ機能
- 指数バックオフによる待機時間制御
- 高度なHTTPヘッダー設定
- 地域バイパス機能
- SSL証明書チェックの最適化

### 音声処理
- 最高品質音声ストリームの自動選択
- MP3形式への変換（192kbps）
- ffmpegによる高品質処理

### 映像処理
- 最高画質動画の自動選択
- MP4形式への変換
- 音声トラックの保持

## ファイル構成

```
youtube-youku-downloader/
├── main.py              # メインアプリケーション（403エラー対策版）
├── requirements.txt     # Python依存関係
├── packages.txt         # システムパッケージ（ffmpeg）
└── README.md           # このファイル
```

### requirements.txtの内容
```
streamlit
yt-dlp
ffmpeg-python
requests
certifi
urllib3
brotli
websockets
```

## ライセンスと免責事項

### 利用条件
- 教育および個人利用のみ
- 著作権法の遵守
- プラットフォーム利用規約の遵守

### 免責事項
- このツールは教育目的で提供されています
- 作者は利用者による誤用や利用規約違反について責任を負いません
- Streamlit Cloud環境の制約により一部の動画が利用できない場合があります

### 法的注意事項
- 著作権で保護されたコンテンツの無断ダウンロードは法的問題を引き起こす可能性があります
- 各国の著作権法および関連法規を遵守してください
- 商用利用は禁止されています

## 開発者情報

**作者**: wabisuke

### バージョン情報
- **現在のバージョン**: 403エラー対策版
- **対応環境**: Streamlit Cloud最適化
- **最終更新**: 2025年1月

### 技術サポート
- 403エラーに関する詳細な対策情報を内蔵
- Streamlit Cloud環境での動作を前提とした設計
- 継続的なyt-dlpアップデート対応

---

**⚠️ 重要**: このツールは個人の学習および研究目的でのみ使用してください。著作権法を遵守し、コンテンツ作成者の権利を尊重することが重要です。
